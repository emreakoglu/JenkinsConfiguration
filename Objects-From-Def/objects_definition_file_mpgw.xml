<?xml version="1.0" encoding="UTF-8"?>
<dcm:definition xmlns:dcm="urn:datapower:configuration:manager">
	
	<dcm:object-create>
		<Matching name="${import.matching.name}" xmlns:dp="http://www.datapower.com/schemas/management" xmlns:env="http://www.w3.org/2003/05/soap-envelop">
			<mAdminState>enabled</mAdminState>
			<MatchRules>
				<Type>url</Type>
				<HttpTag/>
				<HttpValue/>
				<Url>*</Url>
				<ErrorCode/>
				<XPATHExpression/>
				<Method>default</Method>
				<CustomMethod/>
			</MatchRules>
			<MatchWithPCRE>off</MatchWithPCRE>
			<CombineWithOr>off</CombineWithOr>
		</Matching>
	</dcm:object-create>
	
	<dcm:object-create>
		<StylePolicyRule name="${import.matching.name}" xmlns:dp="http://www.datapower.com/schemas/management" xmlns:env="http://www.w3.org/2003/05/soap-envelope">
			<mAdminState>enabled</mAdminState>
			<Direction>request-rule</Direction>
			<InputFormat>none</InputFormat>
			<OutputFormat>none</OutputFormat>
			<NonXMLProcessing>off</NonXMLProcessing>
			<Unprocessed>off</Unprocessed>
		</StylePolicyRule>
	</dcm:object-create>
	
	<dcm:object-modify class="StylePolicy" name="sample_mpg">
		<dcm:vector-insert-before class="PolicyMaps">
		  <PolicyMaps>
			<Match class="Matching">${import.matching.name}</Match>
			<Rule class="StylePolicyRule">${import.matching.name}</Rule>
		  </PolicyMaps>
		</dcm:vector-insert-before>
	</dcm:object-modify>
	
	<if>
      <isset property="files"/>
      <then>
      	<!-- download target files -->
        <downloadFiles host="${host}" port="${port}" uid="${uid}" pwd="${pwd}" domain="${domain}"
          dumpinput="${dumpinput}" dumpoutput="${dumpoutput}" capturesoma="${capturesoma}"
          filestore="${filestore}" local="${download-dir.to}" files="${files}" />
      </then>
      <else>
        <!-- download all files from the target filestore -->
        <downloadFilestore host="${host}" port="${port}" uid="${uid}" pwd="${pwd}" domain="${domain}"
          dumpinput="${dumpinput}" dumpoutput="${dumpoutput}" capturesoma="${capturesoma}"
          filestore="${filestore}" local="${download-dir.to}" dcmdir="${dcm.dir}" />
      </else>
    </if>
	

</dcm:definition>